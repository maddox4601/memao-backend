import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.BVOCwoKb.js";import{I as V}from"./iconify.DpBYtZaw.js";import{A as c}from"./api.BaUma9nm.js";function ae(){const[e,a]=s.useState("messages"),[r,l]=s.useState([]),[n,i]=s.useState({}),[o,d]=s.useState(!1),[x,g]=s.useState(null),[m,h]=s.useState("all"),[u,b]=s.useState(1),[y,p]=s.useState(null),[f,w]=s.useState({is_task_enabled:!1,batch_size:20,airdrop_amount_in_wei:BigInt(0)}),[j,k]=s.useState(!1),[N,_]=s.useState(null),[v,S]=s.useState(20),[I,C]=s.useState("0");s.useEffect((()=>{S(f.batch_size||20),C(Number(f.airdrop_amount_in_wei)/1e18)}),[f]);s.useEffect((()=>{const t=localStorage.getItem("token");t?"messages"===e?B(t):"airdrop"===e&&O(t):window.location.href="/login"}),[e]);const B=async e=>{g(null);try{const t=await fetch(c.CONTACT_LIST,{headers:{Authorization:`Bearer ${e}`}});if(401===t.status)return localStorage.removeItem("token"),void(window.location.href="/login");const a=await t.json();l(a.data||[])}catch{g("获取留言失败")}},O=async e=>{_(null);try{const t=await fetch(c.AIRDROP_CONFIG,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){const e=await t.json();w({...e.data,airdrop_amount_in_wei:BigInt(e.data.airdrop_amount||0)})}else _("加载空投配置失败")}catch(e){console.error("加载配置错误:",e),_("加载空投配置失败")}},T=async e=>{const t=localStorage.getItem("token");if(!t)return alert("请先登录"),void(window.location.href="/login");k(!0),_(null);try{const a=await(await fetch(c.AIRDROP_CONFIG,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({...e,airdrop_amount:e.airdrop_amount_in_wei?.toString()})})).json();a.success?(w((t=>({...t,...e,airdrop_amount_in_wei:BigInt(a.data.airdrop_amount||0)}))),_("配置更新成功")):_(a.message||"配置更新失败")}catch(e){console.error("更新配置错误:",e),_("配置更新失败")}finally{k(!1)}},A=r.filter((e=>"replied"===m?e.replied:"unreplied"!==m||!e.replied)),z=Math.ceil(A.length/5),R=A.slice(5*(u-1),5*u);return t.jsxs("div",{className:"flex max-w-7xl mx-auto min-h-screen bg-gray-50 dark:bg-gray-900 rounded-lg shadow-lg overflow-hidden",children:[t.jsxs("nav",{className:"w-52 bg-gray-100 dark:bg-gray-800 p-5 border-r border-gray-300 dark:border-gray-700 flex flex-col",children:[t.jsx("h2",{className:"text-xl font-bold mb-6 text-gray-800 dark:text-white text-center",children:"管理后台"}),t.jsxs("ul",{className:"space-y-4 flex-1",children:[t.jsx("li",{children:t.jsx("button",{className:"w-full text-left px-4 py-2 rounded-lg transition "+("messages"===e?"bg-blue-600 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"),onClick:()=>a("messages"),children:"用户留言管理"})}),t.jsx("li",{children:t.jsx("button",{className:"w-full text-left px-4 py-2 rounded-lg transition "+("airdrop"===e?"bg-blue-600 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"),onClick:()=>a("airdrop"),children:"空投管理"})})]})]}),t.jsxs("main",{className:"flex-1 p-6 sm:p-10 overflow-y-auto",children:["messages"===e&&t.jsxs(t.Fragment,{children:[t.jsx("h1",{className:"text-3xl font-bold mb-6 text-gray-800 dark:text-white",children:"用户留言管理"}),t.jsx("div",{className:"flex justify-center flex-wrap gap-4 mb-6",children:["all","unreplied","replied"].map((e=>t.jsx("button",{onClick:()=>{h(e),b(1)},className:"px-5 py-2 text-sm rounded-full transition "+(m===e?"bg-blue-600 text-white shadow":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"),children:"all"===e?"全部":"replied"===e?"已回复":"未回复"},e)))}),x&&t.jsx("p",{className:"text-red-500 text-center mb-4",children:x}),0===A.length&&t.jsx("p",{className:"text-center text-gray-500",children:"暂无留言"}),t.jsx("div",{className:"space-y-6",children:R.map((e=>t.jsxs("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl shadow p-6",children:[t.jsxs("div",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:["用户名：",t.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:e.username})," ","| 提交时间：",t.jsx("span",{className:"ml-1",children:e.created_at})]}),t.jsxs("div",{className:"mb-2 flex items-center text-sm text-gray-500 dark:text-gray-400 flex-wrap gap-2",children:[t.jsx("span",{children:"邮箱："}),t.jsx("span",{className:"text-gray-700 dark:text-gray-300 select-all",children:e.email}),t.jsxs("button",{onClick:()=>((e,t)=>{navigator.clipboard?navigator.clipboard.writeText(e).then((()=>{p(t),setTimeout((()=>{p(null)}),1500)})):alert("浏览器不支持复制功能")})(e.email,e.id),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex items-center space-x-1","aria-label":"复制邮箱",title:"复制邮箱",children:[t.jsx(V,{icon:"tabler:copy",className:"h-5 w-5"}),y===e.id&&t.jsx("span",{className:"ml-2 text-green-600 dark:text-green-400 text-xs font-semibold select-none",children:"复制成功"})]})]}),t.jsxs("p",{className:"text-base text-gray-800 dark:text-gray-200 mb-4",children:["留言内容：",e.message]}),e.replied?t.jsxs("div",{className:"bg-green-100 dark:bg-green-800/30 text-green-800 dark:text-green-200 p-3 rounded-md text-sm",children:["已回复：",e.replay_content]}):t.jsxs("div",{className:"space-y-3",children:[t.jsx("textarea",{placeholder:"请输入回复内容...",value:n[e.id]||"",onChange:t=>((e,t)=>{i((a=>({...a,[e]:t})))})(e.id,t.target.value),rows:4,className:"w-full p-3 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("button",{disabled:o,onClick:()=>(async e=>{const t=n[e];if(!t||""===t.trim())return alert("回复内容不能为空");const a=localStorage.getItem("token");if(!a)return alert("请先登录"),void(window.location.href="/login");try{d(!0);const r=await fetch(c.CONTACT_REPLY(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({reply:t})});if(401===r.status)return alert("登录已过期，请重新登录"),localStorage.removeItem("token"),void(window.location.href="/login");const s=await r.json();alert(s.message),s.success&&(B(a),i((t=>({...t,[e]:""}))))}catch{alert("发送失败，请重试")}finally{d(!1)}})(e.id,e.email),className:"w-full sm:w-auto inline-block px-6 py-2 text-sm font-medium text-white rounded-lg transition "+(o?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:o?"发送中...":"发送回复"})]})]},e.id)))}),z>1&&t.jsx("div",{className:"mt-8 flex justify-center flex-wrap gap-2",children:Array.from({length:z},((e,t)=>t+1)).map((e=>t.jsx("button",{onClick:()=>b(e),className:"px-4 py-2 rounded-md text-sm font-medium transition "+(u===e?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200"),children:e},e)))})]}),"airdrop"===e&&t.jsxs("section",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6 max-w-2xl mx-auto",children:[t.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800 dark:text-white text-center",children:"空投管理"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-wrap gap-6",children:[t.jsxs("label",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",checked:f.is_task_enabled,onChange:e=>T({is_task_enabled:e.target.checked}),disabled:j,className:"cursor-pointer"}),t.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"启用定时空投任务"})]}),t.jsxs("label",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"批次用户分组数量:"}),t.jsx("input",{type:"number",min:1,max:500,value:v,onChange:e=>{S(e.target.value)},onBlur:()=>{let e=parseInt(v);(isNaN(e)||e<1)&&(e=1),e>500&&(e=500),e!==f.batch_size&&T({batch_size:e}),S(e)},disabled:j,className:"w-20 p-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{className:"mb-1 text-gray-700 dark:text-gray-300",children:"每个地址空投数量 (MEMAO):"}),t.jsx("input",{type:"number",min:"0",step:"0.000000000000000001",value:I,onChange:e=>{C(e.target.value)},onBlur:()=>{try{let e=parseFloat(I);(isNaN(e)||e<0)&&(e=0);const t=BigInt(Math.floor(1e18*e));t!==f.airdrop_amount_in_wei&&T({airdrop_amount_in_wei:t}),C(e.toFixed(18).replace(/\.?0+$/,""))}catch(e){console.error("处理空投数量错误:",e),C("0")}},disabled:j,className:"w-full p-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]})]}),t.jsx("button",{disabled:j,onClick:async()=>{const e=localStorage.getItem("token");if(!e)return alert("请先登录"),void(window.location.href="/login");k(!0),_(null);try{const t=await(await fetch(c.AIRDROP_DISTRIBUTE,{method:"POST",headers:{Authorization:`Bearer ${e}`}})).json();t.success?_(`成功：${t.message}`):_(`失败：${t.message}`)}catch{_("触发空投失败")}finally{k(!1)}},className:"mt-6 px-6 py-3 rounded-lg text-white font-semibold transition "+(j?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:j?"处理中...":"立即触发空投发放"}),N&&t.jsx("p",{className:"mt-4 text-sm text-center text-gray-800 dark:text-gray-300",children:N})]})]})]})}export{ae as default};